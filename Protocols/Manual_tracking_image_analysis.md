# Manual Tracking Image Analysis

This protocol contains the standard procedure of extracting inner droplet trajectories using a combined method of `crop-HoughCircles` and `manual tracking`.

## Steps

### Manage the data analysis log

1. Run `data_manage.ipynb`, run the first cell to load the current log
2. Check if the log contains the latest videos. If not, run the `Add entries to log` at the bottom of the notebook, change the folder to new videos folder and run the cell. A list of subfolders will be printed.
3. Fill out the `main_log.csv` file with the new video parameters: date, subfolder, bacterial concentration, MPP and FPS
4. Save the `main_log.csv` file, reload it in the notebook.

### Analyze a video

1. From the log, find a video that has not been analyzed
2. Measure the position and size of the droplets, save in `dropSize.xlsx`, update the log
  - NOTE: `dropSize.xlsx` should be created under the main folder, instead of crop_HoughCircles folder
3. Run `crop-HoughCircles-Copy1.ipynb`, copy the video directory to it and run crop-HoughCircles tracking according to the instructions in the notebook
4. Manually correct the tracking and save **traj.csv**:
  1. Load the cropped images generated by the tracking program in `ImageJ`
  2. Make a Montage of the images, look for erroneous results
  3. Determine the cause of the error: if the crop region is misled by some low quality images, skip those images and run the HoughCircles again. For those images where the algorithm cannot find a circle, do manual tracking in `ImageJ`.

5. Combine **traj.csv** and **StagePositions.txt**, pay attention to the unit conversion, save **xyz-traj.csv** (`3D trajectory.ipynb`).
6. Make **3d-traj-animation.avi**
7. Make **3d-traj-RVRef.avi**

## Output file checklist

- **traj.csv**: 2D trajectory text file, use `crop-HoughCircles-Copy1.ipynb` to produce, and use `ImageJ Manual Tracking` to correct
- **xyz-traj.csv**: 3D trajectory text file, use `3D trajectory.ipynb` to produce
- **Montage.jpg**: `ImageJ`, check the quality of tracking
- **2d-image.jpg**: `3D trajectory.ipynb`, an overview of 2d trajectory
- **3d-traj-animation.avi**: use `3D trajectory.ipynb` to produce *.jpg, and use `ImageJ` to compose a video
- **3d-traj-RVRef.avi**: use `3D trajectory.ipynb` to produce *.jpg, and use `ImageJ` to compose a video
